## 4. 优惠券基础表 (voucher)

| 字段名          | 类型          | 允许空 | 默认值               | 约束               | 说明                     |
|-----------------|---------------|--------|----------------------|--------------------|--------------------------|
| id              | bigint        | NO     | 自增                 | PRIMARY KEY       | 优惠券ID                 |
| title           | varchar(100)  | NO     |                      |                    | 优惠券标题               |
| type            | tinyint       | NO     | 0                    |                    | 类型(0-普通券,1-秒杀券)  |
| value           | decimal(10,2) | NO     |                      |                    | 抵扣金额/折扣值          |
| rules           | varchar(500)  | YES    |                      |                    | 使用规则(JSON格式)        |
| stock           | int           | YES    |                      |                    | 库存(秒杀券专用)         |
| begin_time      | datetime      | NO     |                      |                    | 生效时间                 |
| end_time        | datetime      | NO     |                      |                    | 过期时间                 |
| status          | tinyint       | NO     | 1                    |                    | 状态(0-下架,1-可用)       |
| created_at      | datetime      | NO     | CURRENT_TIMESTAMP    |                    | 创建时间                 |
| updated_at      | datetime      | NO     | CURRENT_TIMESTAMP    | ON UPDATE CURRENT_TIMESTAMP | 更新时间      |

**索引：**
- 普通索引 idx_type_status (type, status)

```sql
CREATE TABLE `voucher`
(
    `id`         bigint         NOT NULL AUTO_INCREMENT COMMENT '优惠券ID',
    `title`      varchar(100)   NOT NULL COMMENT '优惠券标题',
    `type`       tinyint        NOT NULL DEFAULT '0' COMMENT '类型(0-普通券,1-秒杀券)',
    `value`      decimal(10, 2) NOT NULL COMMENT '抵扣金额/折扣值',
    `rules`      varchar(500)            DEFAULT NULL COMMENT '使用规则(JSON格式)',
    `stock`      int                     DEFAULT NULL COMMENT '库存(秒杀券专用)',
    `begin_time` datetime       NOT NULL COMMENT '生效时间',
    `end_time`   datetime       NOT NULL COMMENT '过期时间',
    `status`     tinyint        NOT NULL DEFAULT '1' COMMENT '状态(0-下架,1-可用)',
    `created_at` datetime       NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updated_at` datetime       NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    PRIMARY KEY (`id`),
    KEY `idx_type_status` (`type`, `status`)
) ENGINE = InnoDB
  DEFAULT CHARSET = utf8mb4 COMMENT '优惠券基础表';
```
---

## 5. 秒杀券扩展表 (seckill_voucher)

| 字段名          | 类型          | 允许空 | 默认值               | 约束               | 说明                     |
|-----------------|---------------|--------|----------------------|--------------------|--------------------------|
| id              | bigint        | NO     |                      | PRIMARY KEY, FOREIGN KEY (voucher.id) | 关联券ID      |
| limit_per_user  | int           | NO     | 1                    |                    | 每人限购数量             |
| start_time      | datetime      | NO     |                      |                    | 秒杀开始时间             |
| end_time        | datetime      | NO     |                      |                    | 秒杀结束时间             |

```sql
CREATE TABLE `seckill_voucher`
(
    `id`             bigint   NOT NULL COMMENT '关联券ID',
    `limit_per_user` int      NOT NULL DEFAULT '1' COMMENT '每人限购数量',
    `start_time`     datetime NOT NULL COMMENT '秒杀开始时间',
    `end_time`       datetime NOT NULL COMMENT '秒杀结束时间',
    PRIMARY KEY (`id`),
    CONSTRAINT `fk_seckill_voucher_voucher` FOREIGN KEY (`id`) REFERENCES `voucher` (`id`)
) ENGINE = InnoDB
  DEFAULT CHARSET = utf8mb4 COMMENT '秒杀券扩展表';

```
---

## 6. 用户优惠券表 (user_voucher)

| 字段名          | 类型          | 允许空 | 默认值               | 约束               | 说明                     |
|-----------------|---------------|--------|----------------------|--------------------|--------------------------|
| id              | bigint        | NO     | 自增                 | PRIMARY KEY       | 记录ID                   |
| user_id         | bigint        | NO     |                      | FOREIGN KEY (users.id) | 用户ID           |
| voucher_id      | bigint        | NO     |                      | FOREIGN KEY (voucher.id) | 优惠券ID         |
| status          | tinyint       | NO     | 0                    |                    | 状态(0-未使用,1-已使用,2-已过期) |
| used_time       | datetime      | YES    |                      |                    | 使用时间                 |
| order_id        | bigint        | YES    |                      |                    | 关联订单ID               |
| created_at      | datetime      | NO     | CURRENT_TIMESTAMP    |                    | 领取时间                 |

**索引：**
- 组合索引 idx_user_voucher (user_id, voucher_id)
- 索引 idx_status (status)

```sql
CREATE TABLE `user_voucher`
(
    `id`         bigint   NOT NULL AUTO_INCREMENT COMMENT '记录ID',
    `user_id`    bigint   NOT NULL COMMENT '用户ID',
    `voucher_id` bigint   NOT NULL COMMENT '优惠券ID',
    `status`     tinyint  NOT NULL DEFAULT '0' COMMENT '状态(0-未使用,1-已使用,2-已过期)',
    `used_time`  datetime          DEFAULT NULL COMMENT '使用时间',
    `order_id`   bigint            DEFAULT NULL COMMENT '关联订单ID',
    `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '领取时间',
    PRIMARY KEY (`id`),
    KEY `idx_user_voucher` (`user_id`, `voucher_id`),
    KEY `idx_status` (`status`),
    CONSTRAINT `fk_user_voucher_users` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`),
    CONSTRAINT `fk_user_voucher_voucher` FOREIGN KEY (`voucher_id`) REFERENCES `voucher` (`id`)
) ENGINE = InnoDB
  DEFAULT CHARSET = utf8mb4 COMMENT '用户优惠券表';
```
---

## 7. 订单表 (orders)

| 字段名          | 类型          | 允许空 | 默认值               | 约束               | 说明                     |
|-----------------|---------------|--------|----------------------|--------------------|--------------------------|
| id              | bigint        | NO     | 自增                 | PRIMARY KEY       | 订单ID                   |
| user_id         | bigint        | NO     |                      | FOREIGN KEY (users.id) | 用户ID           |
| voucher_id      | bigint        | YES    |                      | FOREIGN KEY (voucher.id) | 使用优惠券ID     |
| amount          | decimal(10,2) | NO     |                      |                    | 订单原金额               |
| discount        | decimal(10,2) | NO     | 0.00                 |                    | 优惠金额                 |
| actual_pay      | decimal(10,2) | NO     |                      |                    | 实付金额                 |
| status          | tinyint       | NO     | 0                    |                    | 状态(0-待支付,1-已支付,2-已取消,3-已退款) |
| payment_time    | datetime      | YES    |                      |                    | 支付时间                 |
| created_at      | datetime      | NO     | CURRENT_TIMESTAMP    |                    | 创建时间                 |
| updated_at      | datetime      | NO     | CURRENT_TIMESTAMP    | ON UPDATE CURRENT_TIMESTAMP | 更新时间      |

**索引：**
- 组合索引 idx_user_status (user_id, status)
- 索引 idx_create_time (created_at)

```sql
CREATE TABLE `orders`
(
    `id`           bigint         NOT NULL AUTO_INCREMENT COMMENT '订单ID',
    `user_id`      bigint         NOT NULL COMMENT '用户ID',
    `voucher_id`   bigint                  DEFAULT NULL COMMENT '使用优惠券ID',
    `amount`       decimal(10, 2) NOT NULL COMMENT '订单原金额',
    `discount`     decimal(10, 2) NOT NULL DEFAULT '0.00' COMMENT '优惠金额',
    `actual_pay`   decimal(10, 2) NOT NULL COMMENT '实付金额',
    `status`       tinyint        NOT NULL DEFAULT '0' COMMENT '状态(0-待支付,1-已支付,2-已取消,3-已退款)',
    `payment_time` datetime                DEFAULT NULL COMMENT '支付时间',
    `created_at`   datetime       NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updated_at`   datetime       NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    PRIMARY KEY (`id`),
    KEY `idx_user_status` (`user_id`, `status`),
    KEY `idx_create_time` (`created_at`),
    CONSTRAINT `fk_orders_users` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`),
    CONSTRAINT `fk_orders_voucher` FOREIGN KEY (`voucher_id`) REFERENCES `voucher` (`id`)
) ENGINE = InnoDB
  DEFAULT CHARSET = utf8mb4 COMMENT '订单表';
```