# 数据库表结构文档

## 1. 角色表 (roles)

| 字段名       | 类型         | 允许空 | 默认值               | 约束               | 说明               |
|--------------|--------------|--------|----------------------|--------------------|--------------------|
| id           | bigint       | NO     | 自增                 | PRIMARY KEY       | 角色ID             |
| role_name    | varchar(50)  | NO     |                      | UNIQUE (idx_role_name) | 角色名称           |
| role_code    | varchar(50)  | NO     |                      | UNIQUE (idx_role_code) | 角色编码           |
| description  | varchar(255) | YES    |                      |                    | 角色描述           |
| status       | tinyint      | NO     | 1                    |                    | 状态(0-禁用,1-正常)|
| created_at   | datetime     | NO     | CURRENT_TIMESTAMP    |                    | 创建时间           |
| updated_at   | datetime     | NO     | CURRENT_TIMESTAMP    | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引：**
- 唯一索引 idx_role_code (role_code)
- 唯一索引 idx_role_name (role_name)

**建表语句：**
```sql
create table roles
(
    id          bigint auto_increment comment '角色ID'
        primary key,
    role_name   varchar(50)                        not null comment '角色名称',
    role_code   varchar(50)                        not null comment '角色编码',
    description varchar(255)                       null comment '角色描述',
    status      tinyint  default 1                 not null comment '状态(0-禁用,1-正常)',
    created_at  datetime default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_at  datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    constraint idx_role_code
        unique (role_code),
    constraint idx_role_name
        unique (role_name)
)
    comment '角色表';
```
---

## 2. 用户表 (users)

| 字段名       | 类型         | 允许空 | 默认值               | 约束               | 说明               |
|--------------|--------------|--------|----------------------|--------------------|--------------------|
| id           | bigint       | NO     | 自增                 | PRIMARY KEY       | 用户ID             |
| username     | varchar(50)  | NO     |                      | UNIQUE (idx_username) | 用户名             |
| password     | varchar(255) | NO     |                      |                    | 密码               |
| email        | varchar(100) | NO     |                      | UNIQUE (idx_email) | 邮箱               |
| phone        | varchar(20)  | YES    |                      |                    | 手机号             |
| avatar       | varchar(255) | YES    |                      |                    | 头像URL            |
| status       | tinyint      | NO     | 1                    |                    | 状态(0-禁用,1-正常)|
| last_login   | datetime     | YES    |                      |                    | 最后登录时间       |
| created_at   | datetime     | NO     | CURRENT_TIMESTAMP    |                    | 创建时间           |
| updated_at   | datetime     | NO     | CURRENT_TIMESTAMP    | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引：**
- 唯一索引 idx_email (email)
- 唯一索引 idx_username (username)

```sql
create table users
(
    id         bigint auto_increment comment '用户ID'
        primary key,
    username   varchar(50)                        not null comment '用户名',
    password   varchar(255)                       not null comment '密码',
    email      varchar(100)                       not null comment '邮箱',
    phone      varchar(20)                        null comment '手机号',
    avatar     varchar(255)                       null comment '头像URL',
    status     tinyint  default 1                 not null comment '状态(0-禁用,1-正常)',
    last_login datetime                           null comment '最后登录时间',
    created_at datetime default CURRENT_TIMESTAMP not null comment '创建时间',
    updated_at datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    constraint idx_email
        unique (email),
    constraint idx_username
        unique (username)
)
    comment '用户表';
```
---

## 3. 用户角色关联表 (user_role)

| 字段名       | 类型         | 允许空 | 默认值               | 约束               | 说明               |
|--------------|--------------|--------|----------------------|--------------------|--------------------|
| id           | bigint       | NO     | 自增                 | PRIMARY KEY       | 关联ID             |
| user_id      | bigint       | NO     |                      | FOREIGN KEY (users.id), UNIQUE (user_id+role_id) | 用户ID |
| role_id      | bigint       | NO     |                      | FOREIGN KEY (roles.id) | 角色ID             |
| created_at   | datetime     | NO     | CURRENT_TIMESTAMP    |                    | 创建时间           |

**约束：**
- 唯一组合索引 idx_user_role (user_id, role_id)
- 外键 fk_user_role_role 关联 roles(id) ON DELETE CASCADE
- 外键 fk_user_role_user 关联 users(id) ON DELETE CASCADE

```sql
create table user_role
(
id         bigint auto_increment comment '关联ID'
primary key,
user_id    bigint                             not null comment '用户ID',
role_id    bigint                             not null comment '角色ID',
created_at datetime default CURRENT_TIMESTAMP not null comment '创建时间',
constraint idx_user_role
unique (user_id, role_id),
constraint fk_user_role_role
foreign key (role_id) references roles (id)
on delete cascade,
constraint fk_user_role_user
foreign key (user_id) references users (id)
on delete cascade
)
comment '用户角色关联表';
```
